        <!DOCTYPE html>
      <html lang="en">
      <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Migraine Diary</title>
        <style>
        body { margin:0; font-family:"Inter",sans-serif; background:#f9f9f9; }

        .login-container {
          display:flex; align-items:center; justify-content:center;
          height:100vh; background:#f9f9f9; padding:16px;
        }
        .login-box {
          background:#fff; padding:24px; border-radius:12px;
          box-shadow:0 4px 12px rgba(0,0,0,.1); width:100%; max-width:360px;
        }
        .login-box h2 { margin-top:0; text-align:center; color:#83358F; font-size:22px; }
        .field { display:flex; flex-direction:column; margin-bottom:18px; }
    /* --- FIELD LABELS & INPUTS --- */
    label { 
      font-size:16px;   /* ðŸ”¥ CHANGED from 14px */
      margin-bottom:8px; 
      color:#333; 
    }
    input {
      padding:14px;
      border-radius:10px;
      border:1px solid #83358F;   /* ðŸ”¥ now uses theme color */
      font-size:17px;
      box-shadow: inset 0 1px 2px rgba(0,0,0,0.06);
    }

    /* --- OTP Buttons --- */
    .otp-btn {
      padding:14px 24px;   /* ðŸ”¥ bigger button */
      border:none;
      border-radius:14px;
      font-size:17px;      /* ðŸ”¥ larger text */
      font-weight:600;
      color:#fff;
      cursor:pointer;
      width:100%;
      margin-top:12px;
      background:linear-gradient(135deg,#83358F,#83358F);
      box-shadow:0 4px 12px rgba(0,0,0,0.2);
      transition:all .25s ease;
    }

    /* --- OTP input specifically --- */
    #otpInput {
      margin-bottom:14px;
      font-size:18px;      /* ðŸ”¥ larger */
      padding:14px;        /* ðŸ”¥ more padding */
    }

  .patient-info {
    font-size: 16px;
    color: #83358F;       /* match theme */
    margin-top: 6px;
    font-weight: 700;
  }



    /* --- Mobile hint (number shown after fetch) --- */
    #mobileHint {
      font-size:18px;      /* ðŸ”¥ larger */
      font-weight:600;
      color:#83358F;
      margin-top:6px;
    }

        .error-msg { color:#dc2626; font-size:13px; margin-top:-6px; margin-bottom:10px; display:none; }

          /* --- Buttons --- */
          .btn-main {
            padding:12px 18px; border-radius:10px; border:none;
            background:linear-gradient(135deg,#83358F,#83358F);
            color:#fff; font-weight:600; cursor:pointer; width:100%;
            font-size:15px; box-shadow:0 4px 10px rgba(0,0,0,0.15);
            transition:all .25s ease;
          }
          .btn-main:hover {
            background:linear-gradient(135deg,#83358F,#83358F);
            transform:translateY(-2px);
            box-shadow:0 6px 14px rgba(0,0,0,0.2);
          }
          .btn-main:disabled { background:#aaa; cursor:not-allowed; }

          /* --- Extra spacing for OTP input --- */
          #otpField {
            margin-top:16px;
          }

          .error-msg { color:#dc2626; font-size:13px; margin-top:-6px; margin-bottom:10px; display:none; }

          /* --- Responsive Login --- */
          @media (max-width:480px){
            .login-box { padding:18px; }
            .login-box h2 { font-size:20px; }
            .btn-main, input { font-size:14px; }
          }
        </style>

        <!-- Diary styles unchanged -->
        <style>
          :root {
            --bg: #ffffff;
            --card: #ffffff;
            --muted: #f9f9f9;
            --text: #1f2937;
            --subtext: #6b7280;
            --accent: #83358F;
            --accent-2: #5A2364;
            --shadow: 0 4px 12px rgba(0,0,0,.06);
            --radius: 12px;
          }
    .logo {
      display: block;
      max-width: 80%;   /* scales nicely in the box */
      height: auto;
      margin: 0 auto 20px auto; /* center with spacing below */
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px 20px;
      background: var(--accent);
      color: white;
      font-size: 20px;
      font-weight: bold;
    }

    .header-logo {
      height: 40px;       /* adjust size */
      margin-right: 12px; /* spacing before title */
    }
          *{box-sizing:border-box}
          html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:"Inter",ui-sans-serif,system-ui;}
          .app{display:none;grid-template-rows:auto 1fr;height:100vh;gap:16px;padding:16px;background:var(--bg)}
          header{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px}
          .title{display:flex;align-items:center;gap:12px;background:var(--card);padding:10px 14px;border-radius:var(--radius);box-shadow:var(--shadow)}
          .title h1{margin:0;font-size:22px;font-weight:800;
            background:linear-gradient(90deg,var(--accent),var(--accent-2));
            -webkit-background-clip:text;-webkit-text-fill-color:transparent}
          .controls{display:flex;align-items:center;gap:8px;flex-wrap:nowrap}
          .month-label{min-width:140px;text-align:center;font-weight:700;color:var(--accent-2);font-size:16px}

          button.icon {
            display:inline-flex;align-items:center;justify-content:center;
            background:#83358F;border:none;
            padding:10px 16px;font-size:15px;font-weight:600;
            color:#fff;border-radius:8px;
            box-shadow:0 2px 6px rgba(0,0,0,0.12);
            cursor:pointer;transition:background .2s,transform .1s;
            white-space:nowrap;
          }
    button.icon:hover { background:#83358F; }
    button.icon:active { transform:scale(0.95); }
    #closePanel {background:#ef4444;border-radius:50%;width:36px;height:36px;padding:0;font-size:18px;font-weight:bold;}
    #closePanel:hover { background:#dc2626; }

    .layout{display:grid;grid-template-columns:1fr;height:100%}
    .panel{position:fixed;left:0;top:0;height:100vh;width:360px;max-width:90vw;background:var(--card);border-right:1px solid #ddd;box-shadow:10px 0 30px rgba(0,0,0,.1);transform:translateX(-100%);transition:transform .25s ease;z-index:30;display:flex;flex-direction:column}
    .panel.open{transform:translateX(0)}
    .panel header{padding:18px 16px;border-bottom:1px solid #eee;display:flex;justify-content:space-between;align-items:center}
    .panel main{padding:16px;overflow:auto;display:flex;flex-direction:column;gap:14px}
    .field{display:flex;flex-direction:column;gap:6px}
    label{font-size:13px;color:var(--subtext)}
    select,input[type=text] {
      background:var(--muted);
      border:1px solid #83358F;   /* ðŸ”¥ theme color */
      border-radius:12px;
      padding:10px;
      font-size:14px;
      box-shadow:var(--shadow);
    }
    .panel .actions{margin-top:6px;display:flex;gap:8px}
    .btn{cursor:pointer;font-weight:700;padding:10px 14px;border-radius:12px;background:var(--accent);color:#fff;box-shadow:var(--shadow)}
    .calendar{background:var(--card);border:1px solid #ddd;border-radius:var(--radius);box-shadow:var(--shadow);padding:16px;display:flex;flex-direction:column;gap:12px}
    .weekday-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);   /* âœ… keep same as days */
      font-size: clamp(15px, 2vw, 20px); /* scales responsively */                        /* ðŸ”¥ slightly bigger */
      text-align: center;                      /* âœ… center align */
      color: var(--subtext);
      font-weight: 600;
    }

    .day-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);   /* âœ… matches weekdays */
      grid-auto-rows: 80px;                    /* ðŸ”¥ fixed consistent height */
      gap: 6px;
      flex: 1;
    }

    .day{
    position: relative;   /* âœ… REQUIRED for icon */
    border:1px solid #eee;
    border-radius:14px;
    background:var(--muted);
    cursor:pointer;
    display:flex;
    flex-direction:column;
    padding:6px;
    font-size:13px
  }

    .day .date {
      font-weight: 900;
      font-size: clamp(14px, 2.2vw, 24px);
      line-height: 1.2;
      color: var(--accent-2);
    }
    .day.other-month{opacity:.35}
    .today{outline:2px solid var(--accent)}
    .day.saved-high{background:#ffcccc !important;}
    .day.saved-medium{background:#fff5b7 !important;}
    .day.saved-low{background:#b9f6ca !important;}
  .painkiller-icon {
    position: absolute;
    bottom: 6px;
    right: 6px;
    font-size: 20px;     /* â¬† bigger pill */
    opacity: 0.95;
  }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: transparent;   /* no color */
      color: var(--text);        /* normal text color */
    }

    header .left {
      flex: 0 0 auto;
    }

    header .center {
      flex: 1;
      text-align: center;
    }

    header .right {
      flex: 0 0 auto;
    }

    .header-logo {
      height: 40px;
    }
    header .center h1 {
      color: #83358F;
    }

    /* ðŸ“± Mobile stacking */
    @media (max-width: 600px) {
      header {
        flex-direction: column;
        text-align: center;
        gap: 8px;
      }
        header .left,
      header .center,
      header .right {
        margin: 4px 0;
      }
    }

          @media (max-width:600px){
            .app{padding:8px;}
            .title h1{font-size:18px;}
            .controls button.icon{padding:8px 12px;font-size:14px;}
            .month-label{min-width:auto;font-size:14px;}
            .day-grid {
      grid-auto-rows: 70px;   /* âœ… consistent on mobile */
      gap: 4px;
    }
          }
      /* put this in your <style> */
      .spinner {
        border: 3px solid #eee;
        border-top: 3px solid #83358F;
        border-radius: 50%;
        width: 16px;
        height: 16px;
        animation: spin 1s linear infinite;
        display: inline-block;
        vertical-align: middle;
        margin-left: 8px;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    .legend {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 12px;
      font-size: 14px;
      font-weight: 600;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .legend-dot {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      display: inline-block;
    }

    .legend-dot.high { background: #ff4d4d; }    /* red */
    .legend-dot.medium { background: #ffd633; } /* yellow */
    .legend-dot.low { background: #33cc66; }    /* green */
    html, body {
      max-width: 100%;
      overflow-x: hidden; /* prevent sideways scroll */
    }

    /* âœ… Success Toast */
  .toast {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%) translateY(40px);
    background: #22c55e;
    color: white;
    padding: 14px 22px;
    border-radius: 14px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 15px;
    font-weight: 600;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    opacity: 0;
    pointer-events: none;
    transition: all 0.4s ease;
    z-index: 9999;
  }

  .toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }

  .toast-icon {
    width: 26px;
    height: 26px;
    background: white;
    color: #22c55e;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 900;
    font-size: 16px;
    animation: pop 0.4s ease;
  }

  @keyframes pop {
    0% { transform: scale(0.3); }
    80% { transform: scale(1.1); }
    100% { transform: scale(1); }
  }

        </style>
      </head>
      <body>

    <!-- LOGIN -->
    <div class="login-container" id="loginPage">
      <div class="login-box">
        <img src="images/aayushcarelogowhite.jpg" alt="Logo" class="logo">

        <h2>Patient Login</h2>

        <!-- Patient ID -->
        <div class="field">
          <label>Patient ID</label>
          <input type="text" id="patientId" placeholder="Enter Patient ID" />
          <div class="error-msg" id="patientError">Patient not found.</div>
        </div>

        <!-- Patient Name -->
        <div class="field" id="nameField" style="display:none;">
          <label>Patient Name</label>
          <input type="text" id="patientName" disabled />
        </div>

        <!-- Password -->
        <div class="field" id="passwordField" style="display:none;">
          <label>Password (Last 4 digits of Mobile)</label>
          <input type="password" id="passwordInput" placeholder="Enter Password" />
        </div>

        <!-- Login Button -->
        <button class="otp-btn" id="loginBtn" style="display:none;">
          ðŸ”“ Login
        </button>

      </div>
    </div>

      </div>
      <!-- MIGRAINE DIARY -->
      <div class="app" id="diaryApp">
        <header>
      <div class="left">
        <img src="images/aayushcarelogowhite.jpg" alt="Logo" class="header-logo">
      </div>
      <div class="center">
        <h1>Migraine Diary</h1>
        <div id="patientInfo" class="patient-info"></div>
      </div>
      <div class="controls right">
        <button class="icon" id="prev">âŸ¨</button>
        <div class="month-label" id="monthLabel"></div>
        <button class="icon" id="next">âŸ©</button>
        <button class="icon" id="todayBtn">Today</button>
      </div>
    </header>

          <div class="layout">
            <aside class="panel" id="panel">
              <header>
                <h2>Day Details</h2>
                <button class="icon" id="closePanel">âœ•</button>
              </header>
              <main>
                <div class="field">
                  <label>Date</label>
                  <div id="selectedDate" style="font-weight:700"></div>
                </div>
                <!-- Q1: Duration -->
                <div class="field">
                  <label for="duration">Duration</label>
                  <select id="duration" required>
                    <option value="">Select</option>
                  </select>
                </div>
                <!-- Q2: Intensity -->
                <div class="field">
                  <label for="intensity">Intensity</label>
                  <select id="intensity" required>
                    <option value="">Select</option>
                    <option>High</option>
                    <option>Medium</option>
                    <option>Low</option>
                  </select>
                </div>
                <!-- Q3: Painkillers -->
                <div class="field">
                  <label for="painkiller">Taken Painkillers?</label>
                  <select id="painkiller" required>
                    <option value="">Select</option>
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                  </select>
                </div>
                <div class="field" id="painkillerDetailsField" style="display:none;">
                  <label for="painkillerDetails">Painkiller Details</label>
                  <input 
      type="text" 
      id="painkillerDetails" 
      placeholder="Enter name/details"
      maxlength="100"
    />
                </div>
                <div class="actions">
                  <button class="btn" id="saveBtn">Save</button>
                </div>
              </main>
            </aside>

            <section class="calendar">
              <div class="weekday-grid"><div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div></div>
              <div class="day-grid" id="dayGrid"></div>
    <div class="legend">
      <div class="legend-item">
        <span class="legend-dot high"></span> High
      </div>
      <div class="legend-item">
        <span class="legend-dot medium"></span> Medium
      </div>
      <div class="legend-item">
        <span class="legend-dot low"></span> Low
      </div>
    </div>
            </section>
          </div>
        </div>
      </div>

    <script>
    const API_TOKEN = "7897c339c442e4b:01ff7013b92aa32";
    const API_URL = "https://software.aayushcare.com/api/resource/Patient/";

    let patientData = null;

    const patientInput = document.getElementById("patientId");
    const errorEl = document.getElementById("patientError");

    const nameField = document.getElementById("nameField");
    const nameInput = document.getElementById("patientName");

    const passwordField = document.getElementById("passwordField");
    const passwordInput = document.getElementById("passwordInput");

    const loginBtn = document.getElementById("loginBtn");


    /* -------------------------
      Fetch Patient Data
    -------------------------- */

    let fetchTimeout = null;

    patientInput.addEventListener("input", () => {

      clearTimeout(fetchTimeout);

      errorEl.style.display = "none";

      nameField.style.display = "none";
      passwordField.style.display = "none";
      loginBtn.style.display = "none";

      patientData = null;

      const id = patientInput.value.trim();

      if (!id) return;

      fetchTimeout = setTimeout(async () => {

        try {

          const res = await fetch(API_URL + id, {
            headers: {
              Authorization: "token " + API_TOKEN
            }
          });

          if (!res.ok) throw new Error("Not Found");

          const json = await res.json();

          patientData = json.data;

          if (!patientData) throw new Error("No Data");


          /* Show Patient Name */

          nameInput.value = patientData.patient_name || patientData.name;

          nameField.style.display = "block";
          passwordField.style.display = "block";
          loginBtn.style.display = "block";


        } catch (e) {

          errorEl.textContent = "Patient ID not found.";
          errorEl.style.display = "block";

          patientData = null;
        }

      }, 600);

    });


    /* -------------------------
      Login Verification
    -------------------------- */

    loginBtn.addEventListener("click", () => {

      if (!patientData) return;

      const enteredPassword = passwordInput.value.trim();

      const mobile =
        patientData.mobile ||
        patientData.custom_whatsapp_number ||
        "";

      if (!mobile || mobile.length < 4) {
        alert("Mobile number not available.");
        return;
      }

      const correctPassword = mobile.slice(-4);


      /* Check Password */

  if (enteredPassword === correctPassword) {

    document.getElementById("loginPage").style.display = "none";
    document.getElementById("diaryApp").style.display = "grid";

    window.loggedInPatientId = patientData.name;

    // âœ… Show patient info
    document.getElementById("patientInfo").textContent =
      `ID: ${patientData.name} | ${patientData.patient_name || ""}`;

    allEntries = {};
    render();
  }
  else {

        alert("Incorrect password.");

      }

    });

    function showSuccessToast() {
    const toast = document.getElementById("successToast");

    toast.classList.add("show");

    setTimeout(() => {
      toast.classList.remove("show");
    }, 2500); // hide after 2.5s
  }

    </script>

      <script>
      const pad = n=>String(n).padStart(2,'0');
      const fmtKey=d=>`${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
      const monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];

      let view=new Date();view.setDate(1);
      const todayKey=fmtKey(new Date());
      let activeKey=null;
      let allEntries = {};

      function parseLocalDate(key) {
    const [y, m, d] = key.split('-').map(Number);
    return new Date(y, m - 1, d); // Local midnight
  }


    async function loadAll() {
      if (!window.loggedInPatientId) return {};

      if (Object.keys(allEntries).length) {
        return allEntries; // use cache
      }

      const filters = JSON.stringify([["patient", "=", window.loggedInPatientId]]);
      const fields = JSON.stringify(["date","duration","intensity","pain_killer","pain_killer_details"]);

      const url = `https://software.aayushcare.com/api/resource/Migraine%20Diary
  ?filters=${encodeURIComponent(filters)}
  &fields=${encodeURIComponent(fields)}
  &limit_page_length=1000`;


      try {
        const res = await fetch(url, {
          headers: { "Authorization": "token " + API_TOKEN }
        });

        const json = await res.json();

        allEntries = {};

        if (json.data) {
          json.data.forEach(entry => {
            allEntries[entry.date] = {
              duration: entry.duration,
              intensity: entry.intensity,
              painkiller: entry.pain_killer,
              painkillerDetails: entry.pain_killer_details
            };
          });
        }

        return allEntries;

      } catch (e) {
        console.error("Load error:", e);
        return {};
      }
    }



      const monthLabel=document.getElementById('monthLabel');
      const grid=document.getElementById('dayGrid');
      const prevBtn=document.getElementById('prev');
      const nextBtn=document.getElementById('next');
      const todayBtn=document.getElementById('todayBtn');
      const panel=document.getElementById('panel');
      const closePanel=document.getElementById('closePanel');
      const selectedDateEl=document.getElementById('selectedDate');
      const duration=document.getElementById('duration');
      const intensity=document.getElementById('intensity');
      const painkiller=document.getElementById('painkiller');
      const painkillerDetails=document.getElementById('painkillerDetails');
      const painkillerDetailsField=document.getElementById('painkillerDetailsField');
      const saveBtn=document.getElementById('saveBtn');

    // Fill duration dropdown (Custom Ranges)

    const durationOptions = [
      "Less than 1 hour",
      "1 to 3 hours",
      "3 to 6 hours",
      "6 to 9 hours",
      "9 to 12 hours",
      "More than 12 hours"
    ];

    durationOptions.forEach(text => {
      const opt = document.createElement("option");
      opt.value = text;
      opt.textContent = text;
      duration.appendChild(opt);
    });


      painkiller.addEventListener('change',()=>{
        if(painkiller.value==="Yes"){
          painkillerDetailsField.style.display="block";
          painkillerDetails.required=true;
        } else {
          painkillerDetailsField.style.display="none";
          painkillerDetails.required=false;
        }
      });

      async function render(){
        monthLabel.textContent=`${monthNames[view.getMonth()]} ${view.getFullYear()}`;
        grid.innerHTML='';
        const firstDayIdx=new Date(view.getFullYear(),view.getMonth(),1).getDay();
        const daysInMonth=new Date(view.getFullYear(),view.getMonth()+1,0).getDate();
        let dayCounter=1;
        const answers = await loadAll();
        for(let i=0;i<42;i++){
          const cell=document.createElement('button');
          cell.className='day';
          let dateObj,label,isOther=false;
          if(i<firstDayIdx){label='';isOther=true;}
          else if(dayCounter<=daysInMonth){dateObj=new Date(view.getFullYear(),view.getMonth(),dayCounter);label=dayCounter++;}
          else{label='';isOther=true;}
          if(!isOther){
            const key=fmtKey(dateObj);
            const clickedDate = parseLocalDate(key);
  const today = new Date();
  today.setHours(0,0,0,0);

  if (clickedDate > today) {
    cell.style.opacity = "0.4";
    cell.style.cursor = "not-allowed";
  }
            cell.dataset.key=key;
            cell.innerHTML=`<div class="date">${label}</div>`;
            if(key===todayKey) cell.classList.add('today');
    if (answers[key]) {

      const { intensity, painkiller } = answers[key];

      // ðŸŽ¨ Color by intensity
      if (intensity === "High") cell.classList.add('saved-high');
      if (intensity === "Medium") cell.classList.add('saved-medium');
      if (intensity === "Low") cell.classList.add('saved-low');

      // ðŸ’Š Show icon if painkiller = Yes
      if (painkiller === "Yes") {
        const icon = document.createElement("span");
        icon.className = "painkiller-icon";
        icon.textContent = "ðŸ’Š";
        cell.appendChild(icon);
      }
    }
            cell.addEventListener('click', () => {

    const clickedDate = parseLocalDate(key);
    const today = new Date();

    // Remove time part (important!)
    today.setHours(0,0,0,0);

    if (clickedDate > today) {
      alert("You cannot enter data for future dates.");
      return;
    }

    openPanel(key);
  });

          } else {
            cell.innerHTML=`<div class="date">${label}</div>`;
            cell.classList.add('other-month');
          }
          grid.appendChild(cell);
        }
      }

    async function openPanel(key) {
      activeKey=key;
      const [y,m,d]=key.split('-');
      const date=new Date(+y,+m-1,+d);
      selectedDateEl.textContent=`${monthNames[date.getMonth()]} ${d}, ${y}`;
      panel.classList.add('open');

      const all = await loadAll();
      const data = all[key] || {};

      duration.value = data.duration || '';
      intensity.value = data.intensity || '';
      painkiller.value = data.painkiller || '';
      painkillerDetails.value = data.painkillerDetails || '';
      painkiller.dispatchEvent(new Event('change'));

      if (all[key]) {
        duration.disabled = true;
        intensity.disabled = true;
        painkiller.disabled = true;
        painkillerDetails.disabled = true;
        saveBtn.style.display = "none";
      } else {
        duration.disabled = false;
        intensity.disabled = false;
        painkiller.disabled = false;
        painkillerDetails.disabled = false;
        saveBtn.style.display = "block";
      }
    }
      function closePanelFn(){panel.classList.remove('open');activeKey=null;}
      closePanel.addEventListener('click',closePanelFn);

    saveBtn.addEventListener('click', async () => {

      if (!activeKey || !window.loggedInPatientId) return;

      if (
        !duration.value ||
        !intensity.value ||
        !painkiller.value ||
        (painkiller.value==="Yes" && !painkillerDetails.value)
      ) {
        alert("Please fill all required fields");
        return;
      }

      const body = {
        data: {   // âœ… IMPORTANT
          patient: window.loggedInPatientId,
          date: activeKey,
          duration: duration.value,
          intensity: intensity.value,
          pain_killer: painkiller.value,
          pain_killer_details: painkillerDetails.value
        }
      };

      try {

        const res = await fetch("https://software.aayushcare.com/api/resource/Migraine%20Diary", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "token " + API_TOKEN
          },
          body: JSON.stringify(body)
        });

        const json = await res.json();

        if (!res.ok || json.exc || json._error_message) {
      throw new Error(
        json._error_message ||
        json.message ||
        "Server rejected save"
      );
    }


        /* âœ… Update local cache */
        allEntries[activeKey] = {
    duration: body.data.duration,
    intensity: body.data.intensity,
    painkiller: body.data.pain_killer,
    painkillerDetails: body.data.pain_killer_details
  };


        showSuccessToast();


        render();
        closePanelFn();

      } catch (e) {
        alert("Save Error: " + e.message);
        console.error(e);
      }
    });


      prevBtn.addEventListener('click',()=>{view.setMonth(view.getMonth()-1);render();});
      nextBtn.addEventListener('click',()=>{view.setMonth(view.getMonth()+1);render();});
      todayBtn.addEventListener('click',()=>{view=new Date();view.setDate(1);render();});
      render();
      </script>
  <!-- âœ… Success Toast -->
  <div id="successToast" class="toast">
    <div class="toast-icon">âœ“</div>
    <div class="toast-text">Saved Successfully</div>
  </div>

      </body>
      </html>
